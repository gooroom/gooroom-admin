<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UserReqDAO">

	<resultMap type="userReqVO" id="userReqInfo">
		<result property="reqSeq" column="REQ_SEQ"/>
		<result property="userId" column="USER_ID"/>
		<result property="clientId" column="CLIENT_ID"/>
		<result property="regDt" column="REG_DT"/>
		<result property="actionType" column="ACTION_TYPE"/>
		<result property="adminCheck" column="ADMIN_CHECK"/>
		<result property="modDt" column="MOD_DT"/>
		<result property="modUserId" column="MOD_USER_ID"/>
		<result property="usbName" column="USB_NAME"/>
		<result property="usbSerialNo" column="USB_SERIAL_NO"/>
		<result property="usbProduct" column="USB_PRODUCT"/>
		<result property="usbSize" column="USB_SIZE"/>
		<result property="usbVendor" column="USB_VENDOR"/>
		<result property="status" column="STATUS"/>
	</resultMap>

	<select id="selectUserReqList" parameterType="String" resultMap="userReqInfo">
		SELECT URM.REQ_SEQ, URM.USER_ID, URM.ACTION_TYPE, URM.CLIENT_ID,
		URM.REG_DT, URP.USB_NAME, URP.STATUS,
		URP.USB_SERIAL_NO, URP.USB_PRODUCT, URP.USB_SIZE, URP.USB_VENDOR,
		URM.MOD_DT, URM.MOD_USER_ID, URM.ADMIN_CHECK
		FROM USER_REQ_MSTR URM
			LEFT JOIN USER_REQ_PROP URP ON URM.REQ_SEQ = URP.REQ_SEQ
		WHERE URM.USER_ID = #{userId} and URM.ADMIN_CHECK = 'register-approval'
	</select>

	<select id="selectUserReqListPaged" parameterType="String" resultMap="userReqInfo">
		SELECT URM.REQ_SEQ,
		URM.USER_ID,
		URM.ACTION_TYPE,
		URM.CLIENT_ID,
		URM.REG_DT,
		URP.USB_NAME,
		URP.USB_SERIAL_NO,
		URP.USB_PRODUCT,
		URP.USB_SIZE,
		URP.USB_VENDOR,
		URP.STATUS,
		URM.MOD_DT,
		URM.MOD_USER_ID,
		URM.ADMIN_CHECK
		FROM USER_REQ_MSTR URM
		LEFT JOIN
		USER_REQ_PROP URP
		ON URM.REQ_SEQ = URP.REQ_SEQ
		<where>
			<if test="searchKey != null and searchKey != ''">
				AND (URM.USER_ID LIKE CONCAT('%', #{searchKey}, '%') OR URM.USB_NAME LIKE CONCAT('%', #{searchKey}, '%'))
			</if>
		</where>
		ORDER BY ${paramOrderColumn} ${paramOrderDir}
		LIMIT #{paramStart}, #{paramLength}
	</select>

	<select id="selectUserReqListTotalCount" parameterType="hashMap" resultType="long">
		SELECT COUNT(REQ_SEQ) AS CNT
		FROM USER_REQ_MSTR
	</select>

	<select id="selectUserReqListFilteredCount" parameterType="hashMap" resultType="long">
		SELECT COUNT(REQ_SEQ) AS CNT
		FROM USER_REQ_MSTR
		<where>
			<if test="searchKey != null and searchKey != ''">
				AND (URM.USER_ID LIKE CONCAT('%', #{searchKey}, '%') OR URM.USB_NAME LIKE CONCAT('%', #{searchKey}, '%'))
			</if>
		</where>
	</select>

	<select id="selectUserReq" parameterType="String" resultMap="userReqInfo">
		SELECT URM.REQ_SEQ,
		       URM.USER_ID,
		       URM.ACTION_TYPE,
		       URM.CLIENT_ID,
		       URM.REG_DT,
		       URP.USB_NAME,
		       URP.USB_SERIAL_NO,
		       URP.USB_PRODUCT,
		       URP.USB_SIZE,
		       URP.USB_VENDOR,
		       URM.MOD_DT,
		       URM.MOD_USER_ID,
		       URM.ADMIN_CHECK,
		       URP.STATUS
		FROM USER_REQ_MSTR URM
		     LEFT JOIN
		     USER_REQ_PROP URP
		ON URM.REQ_SEQ = URP.REQ_SEQ
		WHERE URM.REQ_SEQ = #{reqSeq}
	</select>

	<update id="updateUserReq" parameterType="userReqVO">
		UPDATE USER_REQ_MSTR SET
		       ADMIN_CHECK = #{adminCheck},
		       MOD_DT = #{modDt},
		       MOD_USER_ID = #{modUserId}
		WHERE
		       REQ_SEQ = #{reqSeq}
	</update>

	<update id="updateUserReqStatus" parameterType="userReqVO">
		UPDATE USER_REQ_PROP SET
		STATUS = #{status}
		WHERE
		REQ_SEQ = #{reqSeq}
	</update>

	<select id="selectUserReqData" parameterType="hashmap" resultMap="userReqInfo">
		SELECT URM.USER_ID,
		URM.CLIENT_ID,
		URM.REG_DT,
		URM.ACTION_TYPE,
		URM.ADMIN_CHECK,
		URM.MOD_DT,
		URM.MOD_USER_ID,
		URP.USB_NAME,
		URP.USB_SERIAL_NO,
		URP.USB_PRODUCT,
		URP.USB_SIZE,
		URP.USB_VENDOR,
		URP.STATUS
		FROM USER_REQ_MSTR URM
		LEFT JOIN
		USER_REQ_PROP URP
		ON URM.REQ_SEQ = URP.REQ_SEQ
		WHERE URM.REQ_SEQ = #{reqSeq}
	</select>

	<insert id="insertUserReqMstr" parameterType="map">
		INSERT INTO USER_REQ_MSTR (req_seq, user_id, client_id, reg_dt, action_type, admin_check, mod_dt, mod_user_id)
		VALUES ((SELECT GRNEXTVAL('USERREQUESTMSTR_SEQ')), #{userId}, #{clientId},#{regDt},#{actionType},#{adminCheck},#{modDt}, #{modUserId})
	</insert>

	<insert id="insertUserReqProp" parameterType="map">
		INSERT INTO USER_REQ_PROP (req_seq, user_id, usb_name, usb_serial_no, usb_product, usb_size, usb_vendor)
		VALUES (#{reqSeq},#{userId},#{usbName},#{usbSerialNo},#{usbProduct},#{usbSize},#{usbVendor})
	</insert>

	<select id="selectUserReqSeq" resultType="String" parameterType="String">
		SELECT req_seq FROM user_req_mstr WHERE user_id=#{userId} AND client_id=#{clientId} AND mod_dt=#{modDt} AND action_type=#{actionType}
	</select>

</mapper>


