<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PotableDAO">

    <resultMap type="portableVO" id="portable">

        <result property="ptgrId" column="PTGR_ID" />
        <result property="adminId" column="ADMIN_ID" />
        <result property="userId" column="USER_ID" />
        <result property="certId" column="CERT_ID" />
        <result property="imageId" column="IMAGE_ID" />
        <result property="logId" column="LOG_ID" />
        <result property="isoPw" column="ISO_PW" />
        <result property="regDt" column="REG_DT" />
        <result property="beginDt" column="BEGIN_DT" />
        <result property="expiredDt" column="EXPIRED_DT" />
        <result property="notiType" column="NOTI_TYPE" />
        <result property="notiEmail" column="NOTI_EMAIL" />
        <result property="buildStatus" column="BUILD_STATUS" />
        <result property="approveStatus" column="APPROVE_STATUS" />
        <result property="isBulk" column="IS_BULK" />
        <result property="statusCd" column="STATUS_CD" />

    </resultMap>

    <resultMap type="portableVO" id="portableView">

        <result property="ptgrId" column="PTGR_ID" />
        <result property="userId" column="USER_ID" />
        <result property="certId" column="CERT_ID" />
        <result property="regDt" column="REG_DT" />
        <result property="beginDt" column="BEGIN_DT" />
        <result property="expiredDt" column="EXPIRED_DT" />
        <result property="buildStatus" column="BUILD_STATUS" />
        <result property="approveStatus" column="APPROVE_STATUS" />
        <result property="statusCd" column="STATUS_CD" />
        <result property="certStatus" column="CERT_STATUS" />
        <result property="imageName" column="IMAGE_NAME" />
        <result property="imageUrl" column="IMAGE_URL" />
        <result property="imageStatus" column="IMAGE_STATUS" />

    </resultMap>

    <select id="selectPortableCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT COUNT(*) CNT
        FROM PTGR_MSTR
        WHERE PTGR_ID = #{ptgrId};
    </select>

    <select id="selectNextPortableNo" resultType="java.lang.Integer">
        SELECT GRNEXTVAL('PTGRMSTR_SEQ') AS PTGR_ID FROM DUAL;
    </select>

    <!-- 포터블구름 정보 생성 -->
    <insert id="insertPortableData" parameterType="portableVO">
        INSERT INTO PTGR_MSTR
            (PTGR_ID, ADMIN_ID, USER_ID,
            CERT_ID, IMAGE_ID, LOG_ID, ISO_PW,
            REG_DT, BEGIN_DT, EXPIRED_DT,
            NOTI_TYPE, NOTI_EMAIL,
            BUILD_STATUS, APPROVE_STATUS, IS_BULK, STATUS_CD)
        VALUES
            (#{ptgrId}, #{adminId}, #{userId},
            #{certId}, #{imageId}, #{logId}, #{isoPw},
            now(), #{beginDt}, #{expiredDt},
            #{notiType}, #{notiEmail},
            #{buildStatus}, #{approveStatus}, #{isBulk}, #{statusCd});
    </insert>

    <select id="selectPortableDataList" parameterType="java.lang.Integer" resultMap="portableView">
        SELECT
            (PTGR_ID, USER_ID, CERT_ID,
            RED_DT, BEGIN_DT, EXPIRED_DT,
            BUILD_STATUS, APPROVE_STATUS, STATUS_CD, CERT_STATUS,
            IMAGE_NAME, IMAGE_URL, IMAGE_STATUS)
        FROM VIEW_PTGR_ADMIN
        WHERE ADMIN_ID IN
            <foreach collection="id" item="item" open="(" separator="," close=")">
                #{adminId}
            </foreach>
        OR ADMIN_ID IS NULL;
    </select>

    <select id="selectPortableDataListPaged" parameterType="hashmap" resultMap="portableView">
        SELECT
            (PTGR_ID, USER_ID, CERT_ID,
            RED_DT, BEGIN_DT, EXPIRED_DT,
            BUILD_STATUS, APPROVE_STATUS, STATUS_CD, CERT_STATUS,
            IMAGE_NAME, IMAGE_URL, IMAGE_STATUS)
        FROM VIEW_PTGR_ADMIN
        WHERE PTGR_ID IN
            <foreach collection="item" item="item" open="(" separator="," close=")">
                PTGR_ID=${item}
            </foreach>
    </select>

    <update id="updatePortableData" parameterType="portableVO">
        UPDATE PTGR_MSTR
        SET ADMIN_ID = #{adminId},
            USER_ID = #{userId},
            CERT_ID = #{certId},
            IMAGE_ID = #{imageId},
            LOG_ID = #[logId},
            ISO_PW = #{isoPw},
            REG_DT = #{regDt},
            BEGIN_DT = #{beginDt},
            EXPIRED_DT = #{expiredDt},
            NOTI_TYPE = #{notiType},
            NOTI_EMAIL = #{notiEmail},
            BUILD_STATUS = #{buildStatus},
            APPROVE_STATUS = #{approveStatus},
            IS_BULK = #{isBulk},
            STATUS_CD = #{statusCd}
        WHERE PTGR_ID = #{ptgrId};
    </update>

    <update id="updateAllPortableApprove" parameterType="java.lang.Integer">
        UPDATE PTGR_MSTR
        SET STATUS_CD = 'APPROVE'
        WHERE PTGR_ID IN
            <foreach collection="adminId" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
    </update>

    <!-- 삭제 -->
    <delete id="deletePortableData" parameterType="hashmap">
        DELETE FROM PTGR_MSTR
        <!-- WHERE PTGR_ID = #{ptgrId}; -->
        WHERE PTGR_ID IN
            <foreach collection="item" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
    </delete>

    <delete id="deleteAllPortableData">
        DELETE FROM PTGR_MSTR;
    </delete>

</mapper>
