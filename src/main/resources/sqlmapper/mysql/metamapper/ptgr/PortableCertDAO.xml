<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PortableCertDAO">

    <resultMap type="portableCertVO" id="portableCert">

        <result property="certId" column="CERT_ID" />
        <result property="password" column="PASSWORD" />
        <result property="publish" column="PUBLISH" />
        <result property="createdDt" column="CREATED_DT" />
        <result property="transferDt" column="TRANSFER_DT" />
        <result property="certPem" column="CERT_PEM" />

    </resultMap>

    <select id="selectCertCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT COUNT(*) CNT
        FROM PTGR_CERT
        WHERE CERT_ID = #{certId};
    </select>

    <select id="selectNextCertNo" resultType="java.lang.Integer">
        SELECT GRNEXTVAL('PTGRCERT_SEQ') AS CERT_ID FROM DUAL;
    </select>

    <!-- 인증서 정보 생성 -->
    <insert id="insertPortableCert" parameterType="portableCertVO">
        INSERT INTO PTGR_CERT
            (CERT_ID, CERT_PW, PUBLISH, CREATED_DT, TRANSFER_DT, CERT_PEM)
        VALUES
            (#{certId}, #{certPw}, #{publish}, #{createdDt}, #{transferDt}, #{certPem});
    </insert>

    <select id="selectPortableCert" parameterType="java.lang.Integer" resultMap="portableCert">
        SELECT C.CREATED_DT, C.TRANSFER_DT
        FROM PTGR_CERT AS C
        WHERE C.CERT_ID = #{certId};
    </select>

    <delete id="deletePortableCert" parameterType="java.lang.Integer">
        DELETE FROM PTGR_CERT
        WHERE CERT_ID = #{certId};
    </delete>

</mapper>
